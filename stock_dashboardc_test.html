// 입력 변화에도 즉시 반영 (위임)
document.addEventListener('input', (e)=>{
  const el = e.target && e.target.closest('.qty');
  if(el) paintQtyCell(el);
});

// --- 핵심 1: render() 끝나면 항상 다시 칠하기 ---
if (typeof render === 'function') {
  const __origRender = render;
  render = function(...args){
    const r = __origRender.apply(this, args);
    // 렌더가 DOM에 반영된 다음 프레임에 칠하기
    queueMicrotask(paintAllQty);
    return r;
  };
}

// --- 핵심 2: tbody 변화 감지해서 자동 재칠 (정렬/추가/삭제 모두 커버) ---
const tbody = document.querySelector('#tbody');
if (tbody) {
  const mo = new MutationObserver((list)=>{
    if (list.some(m=>m.type==='childList')) paintAllQty();
  });
  mo.observe(tbody, {childList:true});
}

// 초기 1회
document.addEventListener('DOMContentLoaded', paintAllQty);
