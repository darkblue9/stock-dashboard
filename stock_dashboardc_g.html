<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>마녀의 주식 대시보드 v4.3 (버그 수정판)</title>
<style>
/* === 기본 스타일 === */
body{font-family:sans-serif;margin:10px;font-size:12px}
table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:12px; margin-top:5px;}
th,td{border:1px solid #ccc;padding:4px 2px;text-align:center;vertical-align:middle}
input,select,button{font:inherit;font-size:12px}
td input[readonly]{background:#f9f9f9; color:#555}
.status{font-size:11px}
.profit-pos{color:green; font-weight:bold}
.profit-neg{color:red; font-weight:bold}

/* === 버튼 및 액션 === */
.actions{display:inline-flex;align-items:center;gap:2px;white-space:nowrap;justify-content:center}
.mv{display:inline-flex;gap:1px}
.mv button,.del,.chart-btn{width:22px;height:22px;font-size:11px;padding:0;margin:0; cursor:pointer; border:1px solid #999; background:#eee; border-radius:3px;}
.del{width:auto;padding:0 6px; background:#fff0f0; border-color:#faa; color:#c00;}
.chart-btn{width:auto;padding:0 6px; background:#f0f8ff; border-color:#abd; color:#005;}
#resetBtn { background: #333; color: #fff; border: 1px solid #000; font-weight: bold; }

/* === 상/하목표 점 === */
@keyframes pulseRed {0%{box-shadow:0 0 0 0 rgba(255,0,0,.8);}100%{box-shadow:0 0 0 6px rgba(255,0,0,0);}}
@keyframes pulseBlue{0%{box-shadow:0 0 0 0 rgba(0,100,255,.8);}100%{box-shadow:0 0 0 6px rgba(0,100,255,0);}}
.dot{width:8px;height:8px;border-radius:50%;background:#bbb;display:inline-block; flex-shrink:0;}
.dot.red{background:#ff4d4d}
.dot.blue{background:#3d7bff}
.blink-red-dot{animation:pulseRed .9s infinite;}
.blink-blue-dot{animation:pulseBlue .9s infinite;}
.target-cell{display:flex;align-items:center;gap:4px;justify-content:center; width:100%;}
.target-cell input { flex: 1; min-width: 0; }

/* === 상단 필터 바 === */
.filter-bar { margin: 8px 0; display:flex; gap: 6px; align-items: center; padding: 4px; background: #f4f4f4; border-radius: 6px; border: 1px solid #ddd; }
.filter-label { font-weight: bold; margin-right: 4px; }
.filter-btn { padding: 5px 12px; border: 1px solid #ccc; background: #fff; cursor: pointer; border-radius: 4px; }
.filter-btn.active { background: #333; color: #fff; border-color: #000; font-weight: bold; }

/* === 그룹 배지 버튼 (단/장) === */
.grp-btn { width: 24px; height: 20px; font-size: 11px; font-weight:bold; border:1px solid rgba(0,0,0,0.1); border-radius: 4px; cursor:pointer; padding:0;}
.grp-short { background: #ffdede; color: #d00; } 
.grp-long  { background: #deeaff; color: #006; }

/* === 토스트, 상단 배지 === */
.top-total{position:fixed;top:50px;right:12px;z-index:6;background:#fff;border:1px solid #ccc;padding:4px 10px;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,.08);font-weight:700}
.total-pos{color:green} .total-neg{color:red}

/* === 트렌드 점 (5분 스냅샷) === */
td.cur-cell { position: relative; padding-bottom: 14px; }
td.cur-cell .trend-dots { position: absolute; left:50%; transform:translateX(-50%); bottom:1px; display:flex; gap:4px; }
.trend-dot { width:6px; height:6px; border-radius:50%; background:#ddd; opacity:.5 }
.trend-dot.up   { background:#e53935; opacity:1; }
.trend-dot.down { background:#1e88e5; opacity:1; }

/* === 델타 배지 === */
.delta-badges{display:block; font-size:10px; margin-top:2px; line-height: 1.1;}
.delta-badge{ display:inline-block; border-radius:4px; padding:0 3px; margin:0 1px;}
.delta-pos{background:#ffebeb; color:#c00;}
.delta-neg{background:#ebf3ff; color:#1e5aff;}

/* === 컬럼 폭 설정 === */
#grid td > input { width: 100%; padding: 2px; box-sizing: border-box; text-align: right; border:none; background: transparent;}
#grid td > input:focus { background: #fff; outline: 2px solid #aaa; }
#grid td input.name { text-align: left; }
#grid td input.code { text-align: center; }

col.col-no { width: 30px; }
col.col-group { width: 36px; }
col.col-code { width: 60px; }
col.col-name { width: 100px; }
col.col-avg { width: 70px; }
col.col-qty { width: 40px; }
col.col-inv { width: 80px; }
col.col-target { width: 90px; }
col.col-cur { width: 80px; }
col.col-fix { width: 75px; }
col.col-profit { width: 75px; }
col.col-percent { width: 55px; }
col.col-act { width: 160px; }

@media (max-width: 600px) {
  .actions { flex-wrap: wrap; }
  .filter-bar { flex-wrap: wrap; }
}
</style>
</head>
<body>

<div>
  <details>
    <summary style="cursor:pointer; margin-bottom:4px; font-weight:bold; color:#555;">⚙️ 설정 (API/프록시)</summary>
    <div style="padding:10px; background:#f8f8f8; border:1px solid #ddd; margin-bottom:10px;">
      <label>프록시 <input id="apiBase" value="https://stock-dashboard.respite9.workers.dev" style="width:100%"></label><br>
      <div style="margin-top:4px; display:flex; gap:10px; flex-wrap:wrap;">
        <label>모드 <select id="apiMode"><option value="auto" selected>자동</option><option value="multi">멀티</option><option value="single">단건</option></select></label>
        <label>
