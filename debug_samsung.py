from pykrx import stock
import pandas as pd

# ë‚ ì§œ ê³ ì • (ë„¤ê°€ í™•ì¸í•˜ê³  ì‹¶ì€ ë‚ )
date = "20260129"
ticker = "005930" # ì‚¼ì„±ì „ì ì½”ë“œ

print(f"ğŸ•µï¸ [ì§„ë‹¨ ì‹œì‘] {date} ì‚¼ì„±ì „ì(005930) ì™¸êµ­ì¸ ìˆ˜ê¸‰ ë°ì´í„° ëœ¯ì–´ë³´ê¸°\n")

# 1. ì™¸êµ­ì¸ ë°ì´í„° ìš”ì²­
print("1. PyKRXì— ë°ì´í„° ìš”ì²­ ì¤‘...", end="")
try:
    # "ALL"ë¡œ ì „ì²´ ì¢…ëª©ì„ ê¸ì–´ì™€ì„œ ì‚¼ì„±ì „ìë¥¼ ì°¾ìŒ
    df = stock.get_market_net_purchases_of_equities_by_ticker(date, date, "ALL", investor="foreign")
    print(" ì‘ë‹µ ë°›ìŒ!")
except Exception as e:
    print(f"\nâŒ ì—ëŸ¬ ë°œìƒ: {e}")
    exit()

# 2. ë°ì´í„°ê°€ ë¹„ì—ˆëŠ”ì§€ í™•ì¸
if df.empty:
    print(f"âŒ ì‹¤íŒ¨: {date}ì¼ì ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ìŒ (Empty DataFrame).")
    print("   ğŸ‘‰ ì›ì¸: íœ´ì¥ì´ê±°ë‚˜, ì¥ ì‹œì‘ ì „ì´ê±°ë‚˜, IP ì°¨ë‹¨ë¨.")
    exit()

print(f"âœ… ì „ì²´ ë°ì´í„° ê±´ìˆ˜: {len(df)}ê±´ (ë­”ê°€ ì˜¤ê¸´ ì™”ìŒ)")

# 3. ì»¬ëŸ¼ ì´ë¦„ í™•ì¸ (ì´ê²Œ ì œì¼ ì¤‘ìš”!)
print(f"â„¹ï¸ ì»¬ëŸ¼ ëª©ë¡: {df.columns.tolist()}")

# 4. ì‚¼ì„±ì „ì(005930)ê°€ ìˆëŠ”ì§€ í™•ì¸
if ticker in df.index:
    print("\nğŸ¯ [í™•ì¸ ê²°ê³¼] ì‚¼ì„±ì „ì ë°ì´í„° ë°œê²¬!")
    row = df.loc[ticker]
    print("------------------------------------------------")
    print(row)
    print("------------------------------------------------")
    
    # ìˆœë§¤ìˆ˜ ê°’ë§Œ ì½• ì§‘ì–´ì„œ ì¶œë ¥
    # (ì»¬ëŸ¼ëª…ì— 'ìˆœë§¤ìˆ˜'ë‚˜ 'ê±°ë˜ëŒ€ê¸ˆ'ì´ í¬í•¨ëœ ê²ƒ ì°¾ê¸°)
    found_val = False
    for col in df.columns:
        if "ìˆœë§¤ìˆ˜" in col or "ê±°ë˜ëŒ€ê¸ˆ" in col:
            print(f"ğŸ’° '{col}' ê°’: {row[col]}")
            if row[col] != 0:
                found_val = True
    
    if found_val:
        print("\nğŸ‰ ê²°ë¡ : ë°ì´í„° ì •ìƒ! (ìˆ«ìê°€ ì‚´ì•„ìˆìŒ)")
    else:
        print("\nğŸ’€ ê²°ë¡ : ì¢…ëª©ì€ ìˆëŠ”ë° ê°’ì´ ì „ë¶€ 0ì„ (ì´ìƒí•¨)")

else:
    print(f"\nâŒ ì‹¤íŒ¨: ì¸ë±ìŠ¤ì—ì„œ ì‚¼ì„±ì „ì({ticker})ë¥¼ ëª» ì°¾ìŒ.")
    print(f"   ğŸ‘‰ ì¸ë±ìŠ¤ ìƒ˜í”Œ 5ê°œ: {df.index[:5].tolist()}")
    if 5930 in df.index:
        print("   ğŸ‘‰ ì•„í•˜! ìˆ«ì 5930ìœ¼ë¡œ ë˜ì–´ ìˆìŒ (íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ)")